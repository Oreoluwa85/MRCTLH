#!/usr/bin/perl

use strict;
use warnings;

use Bio::DB::EUtilities;
use Bio::SeqIO;

my $file = "temp.xml";
my $fileout = "taxon.tab";
my $seq_in =  Bio::SeqIO->new( -file =>$file, -format => 'fasta' );
my $seq_out =  Bio::SeqIO->new( -file =>$fileout, -format => 'table' );

my @ids     = qw(297797367 297852000 297840447 297816802 297811057 297847504 15233170 22329949 15235735 42571943 15242311 15223823 145360726 357146516 357134516 357136947 357149528 357113244 357155992 357133848 159463604 159473839 159475252 159486701 159486907 307106515 307106914 307105147 307108475 307109918 307111249 307108222 384248485 384248156 384246141 384253845 384246770 384249362 384248973 356503648 356496044 356555082 356536518 356541828 356569585 356504254 151368152 55832256 326515300 326514566 326504378 326489739 326504018 317106667 317106667 388512057 388267601 388518815 388515565 388499990 357494081 357446091 357445017 357470511 357446439 357495247 357469127 255087092 255079986 255070439 255085108 218184699 218190973 218186092 218189143 125524386 115468720 115482406 115451767 115462239 46389862 115434490 222616297 168037590 168045613 168011554 168031657 167999676 168022726 168044015 148906871 294463446 116783718 148909973 148906610 116782080 224109948 224134494 224113997 224098160 224146356 224104149 224140287 255544179 255560784 255554539 255568187 255561642 255544884 255581490 302801979 302760595 302792715 302779938 302821143 302757547 302762144 242034229 242066298 242041631 242065394 242087009 242056463 242071813 383100763 225437937 225429244 225460573 225448765 359494870 225435441 359481756 302837125 302842869 302851092 302847871 302846465 302852743 226528938 226507618 226505188 226528144 259490386 413920333 212274599);

my $factory = Bio::DB::EUtilities->new(-eutil          => 'elink',
                                       -email          => 'ore.francis@gmail.com',
                                       -db             => 'protein',
                                       -dbfrom         => 'gene',
                                       -id             => \@ids);

#my $hist  = $factory->next_History || die "No history data returned";
$factory->set_parameters(-eutil  => 'efetch',
                      #-history => $hist,
                      -retmode => 'xml',
                      # 'chr', 'flt', 'brief', 'rsr', 'docset'
                      -rettype => '');
 
$factory->get_Response(-file => $file);


my $seqin = Bio::SeqIO->new(-file   => $file,
                            -format => 'fasta');

#while (my $seq = $seqin->next_seq) {
#	print $seq-> display_id,"\t",$seq-> accession_number,"\t",$seq-> #seq,"\t",(($seq->species->ncbi_taxid) or shift),"\t",$seq->species-#>binomial,"\t",$seq->length,"\n";
#	print "done\n";
#	
#}
